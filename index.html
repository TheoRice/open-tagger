<head>

</head>
<body>
    <h1>MDE</h1>
    <form>
        <div>
            <label>Select a video</label>
            <input type='file' accept='video/*' id='vidFile' />
        </div>
        <div>
            <label>Title</label>
            <input type='text' id='title' />
        </div>
        <div>
            <label>Description</label>
            <input type='text' id='description'/>
        </div>
        <div>
            <label>Long Description</label>
            <input type='text' id='longDesc' />
        </div>
        <div>
            <label>Cast</label>
            <input type='text' id='cast' />
        </div>
        <div>
            <label>Directors</label>
            <input type='text' id='directors' />
        </div>
        <div>
            <label>Producers</label>
            <input type='text' id='producers' />
        </div>
        <div>
            <label>Screenwriters</label>
            <input type='text' id='screenwriters' />
        </div>
        <div>
            <label>Studio</label>
            <input type='text' id='studio' />
        </div>
        <div>
            <label>Release Date (YEAR-MONTH-DAY)</label>
            <input type='text' id='year' />
        </div>
        <div>
            <label>Cover</label>
            <input type='file' accept='image/*' id='imgFile' />
        </div>

        Overwrite?  <input type="checkbox", id='overwrite'>
        <button type='submit'>Write to File</button>
    </form>

    <h1 id='duration'></h1>
    

    <script>
        const electron = require('electron');
        const { ipcRenderer } = electron; 
        window.fs = require('fs');

        document.querySelector('form').addEventListener('submit', (event) => {
            event.preventDefault();
            const xmlMOVI = writeXML();
            const vidPath = document.querySelector('#vidFile').files[0].path;
            const imgPath = document.querySelector('#imgFile').files[0].path;
            fs.writeFile('/tmp/xmlMOVI.txt', xmlMOVI, function (err) {
                if (err) throw err;
                console.log('Saved!');
            });
            ipcRenderer.send(
                'video:submit', 
                vidPath, 
                document.getElementById('title').value, 
                imgPath, 
                document.getElementById('description').value,
                document.getElementById('longDesc').value,
                document.getElementById('year').value,
                true,
                document.getElementById('overwrite').checked
            );
        });

        ipcRenderer.on('video:metadata', (err, metadata) => {
            document.getElementById('duration').innerHTML = metadata;
        })

        function writeMultipleNamesToXML(arr, type) {
            namesXML = `\n\t<key>${type}</key>\n\t<array>`;

            for (var i = 0; i < arr.length; i++) {
                namesXML = namesXML + `\n\t\t<dict>
            \t\t<key>name</key>
            \t\t<string>${arr[i]}</string>
        \t</dict>`;
            }

            namesXML = namesXML + `
    \t</array>`;
            return namesXML;
        }

        function writeXML() {
            var xmlfile = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>`;

            // retrieve and parse cast information
            var cast = document.getElementById('cast').value.split(', ');
            xmlfile = xmlfile + writeMultipleNamesToXML(cast,'cast');

            // retrieve and parse directors information
            var directors = document.getElementById('directors').value.split(', ');
            xmlfile = xmlfile + writeMultipleNamesToXML(directors,'directors');

            // retrieve and parse producers information
            var producers = document.getElementById('producers').value.split(', ');
            xmlfile = xmlfile + writeMultipleNamesToXML(producers,'producers');

            // retrieve and parse screen writers information
            var screenwriters = document.getElementById('screenwriters').value.split(', ');
            xmlfile = xmlfile + writeMultipleNamesToXML(screenwriters,'screenwriters');

            // retrieve studio information
            const studio = document.getElementById('studio').value;
            xmlfile = xmlfile + `\n\t<key>studio</key>\n\t<string>${studio}</string>`;
            xmlfile = xmlfile + `
</dict>
</plist>`;
            return xmlfile;
        }
    </script>
</body>
